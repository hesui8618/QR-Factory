<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">免费二维码生成器 - 在线文字转二维码、网址二维码 | QR Factory</title>
    <meta name="description" data-i18n="metaDescription" content="QR Factory 提供简单快速的二维码生成工具，支持文字二维码、网址二维码、联系人二维码，在线生成，免费使用，支持PNG下载。">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/source-han-sans-cn@2.0.1/build/css/source-han-sans-cn.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary-color: #007aff;
            --success-color: #34c759;
            --error-color: #ff3b30;
            --background-color: #f7f7f8;
            --card-background: #ffffff;
            --text-color: #1d1d1f;
            --light-text: #6e6e73;
            --border-color: #d2d2d7;
            --font-family-sans: 'Inter', 'Source Han Sans CN', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            --border-radius-large: 12px;
            --border-radius-small: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family-sans);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--light-text);
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        .app-container {
            background-color: var(--card-background);
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background-color: transparent;
            border-bottom: 1px solid var(--border-color);
            padding: 0 20px;
        }
        
        .tab {
            padding: 18px 10px;
            margin: 0 10px;
            cursor: pointer;
            transition: color 0.3s, border-bottom-color 0.3s;
            text-align: center;
            font-weight: 500;
            color: var(--light-text);
            border-bottom: 3px solid transparent;
            position: relative;
            top: 1px;
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 700;
        }
        
        .tab:hover:not(.active) {
            color: var(--text-color);
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .input-section {
            flex: 1;
            padding: 30px;
            min-width: 400px;
            border-right: 1px solid var(--border-color);
        }
        
        .preview-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #fafafa;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        /* 可折叠部分样式 */
        .collapsible-section {
            /* 移除外边框 */
            /* border: 1px solid var(--border-color); */
            border-radius: var(--border-radius-small);
            margin-bottom: 25px; /* 与其他 input-group 保持一致的底部间距 */
            overflow: hidden;
        }

        .collapsible-header {
            padding: 14px 18px;
            background-color: var(--background-color);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* 添加边框到标题 */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small); /* 与 section 保持一致的圆角 */
            margin-bottom: 25px; /* 将底部间距移到标题 */
            transition: background-color 0.3s;
        }

        .collapsible-header:hover {
            background-color: #f0f0f0;
        }

        .collapsible-header.active {
            /* 移除激活状态下底部边框的特殊处理，因为现在标题本身有边框 */
            /* border-bottom-color: transparent; */
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom-color: transparent;
        }

        .collapsible-content {
            padding: 18px;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            border-bottom-left-radius: var(--border-radius-small);
            border-bottom-right-radius: var(--border-radius-small);
            margin-top: -25px; /* 向上移动，以填补标题的 margin-bottom */
            position: relative; /* 确保 z-index 正常工作 */
            z-index: 1; /* 确保内容在标题下方 */
        }

        .collapsible-content.active {
            max-height: 500px; /* 足够大的高度以显示内容 */
            opacity: 1;
        }

        .collapsible-content .input-group {
            margin-bottom: 15px; /* 可折叠内容内部的 input-group 间距 */
        }

        .collapsible-content .input-group:last-child {
            margin-bottom: 0;
        }

        .arrow-icon {
            transition: transform 0.3s ease-in-out;
        }

        .collapsible-header.active .arrow-icon {
            transform: rotate(180deg);
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 1rem;
        }
        
        input[type="text"], input[type="tel"], input[type="email"], textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-small);
            font-size: 16px;
            background-color: #fff;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus, input[type="tel"]:focus, input[type="email"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
        }
        
        .error {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 12px;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-align: center;
        }

        button:active {
            transform: scale(0.98);
        }
        
        .generate-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        .generate-btn:hover {
            background-color: #006ae0;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2);
        }
        
        .download-btn {
            background-color: var(--success-color);
            color: white;
        }
        
        .download-btn:hover {
            background-color: #2fb44f;
        }

        .download-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .clear-btn {
            background-color: transparent;
            color: var(--light-text);
            border: 1px solid var(--border-color);
        }
        
        .clear-btn:hover {
            background-color: #f5f5f5;
            color: var(--text-color);
        }
        
        .preview-section h3 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .qrcode-container {
            margin-top: 10px;
            padding: 25px;
            background-color: white;
            border-radius: var(--border-radius-large);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 450px;
            height: 450px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s;
        }

        /* 移除二维码容器的缩放效果，以确保与按钮对齐 */
        /* .qrcode-container:has(canvas) {
            transform: scale(1.03);
        } */
        
        .qrcode-message {
            text-align: center;
            color: var(--light-text);
            padding: 0 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .faq-section {
            max-width: 800px;
            margin: 60px auto 0;
            padding: 30px;
            background-color: var(--card-background);
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .faq-section h2 {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .faq-item {
            margin-bottom: 25px;
        }

        .faq-item:last-child {
            margin-bottom: 0;
        }

        .faq-item h3 {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .faq-item p {
            color: var(--light-text);
            font-size: 1rem;
            line-height: 1.7;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            color: var(--light-text);
            font-size: 14px;
        }
        
        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .tabs {
                padding: 0 10px;
                overflow-x: auto;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .tabs::-webkit-scrollbar {
                display: none;
            }

            .tab {
                padding: 15px 5px;
                font-size: 0.9rem;
                margin: 0 8px;
                white-space: nowrap;
            }

            .input-section, .preview-section {
                padding: 20px;
                min-width: 100%;
            }

            .button-group {
                grid-template-columns: 1fr;
            }
            
            .qrcode-container {
                max-width: calc(100% - 40px); /* 100% 减去左右各20px的容器padding */
                height: auto; /* 高度自适应 */
                padding: 15px; /* 减小内边距 */
            }

            .preview-section .button-group {
                max-width: calc(100% - 40px); /* 与二维码容器外部宽度对齐 */
                margin-top: 20px; /* 调整与二维码的间距 */
            }

            .collapsible-header,
            .collapsible-content {
                padding: 12px 15px; /* 调整折叠标题和内容的内边距 */
            }

            .collapsible-content .input-group {
                margin-bottom: 10px;
            }
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        .language-switcher button {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--light-text);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .language-switcher button:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            background-color: rgba(0, 122, 255, 0.05);
        }

        .preview-section .button-group {
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-switcher">
            <button id="lang-toggle"></button>
        </div>
        <header>
            <h1>QR Factory</h1>
            <p class="subtitle" data-i18n="subtitle">简单、快速的二维码生成工具</p>
        </header>
        
        <div class="app-container">
            <div class="tabs">
                <div class="tab active" data-tab="text" data-i18n="tabText">文本二维码</div>
                <div class="tab" data-tab="url" data-i18n="tabUrl">网址二维码</div>
                <div class="tab" data-tab="vcard" data-i18n="tabVcard">联系人二维码</div>
            </div>
            
            <div class="content">
                <div class="input-section">
                    <!-- 文本二维码 -->
                    <div class="tab-content active" id="text-content">
                        <div class="collapsible-section">
                            <div class="collapsible-header active" data-i18n="textHeader">
                                <!-- 占位符，由JS填充 -->
                                <span class="arrow-icon">&#9660;</span>
                            </div>
                            <div class="collapsible-content active">
                                <div class="input-group">
                                    <textarea id="text-input" rows="6" placeholder="请输入需要转换成二维码的文本内容..." data-i18n-placeholder="textPlaceholder" maxlength="1000"></textarea>
                                    <p class="error" id="text-error" data-i18n="textError">请输入有效的文本内容</p>
                                    <p><span id="text-counter">0</span>/1000 <span data-i18n="textCounterUnit">字符</span></p>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="foreground-color" data-i18n="foregroundColorLabel">前景色</label>
                            <input type="color" id="foreground-color" value="#000000">
                        </div>
                        <div class="input-group">
                            <label for="background-color" data-i18n="backgroundColorLabel">背景色</label>
                            <input type="color" id="background-color" value="#FFFFFF">
                        </div>
                    </div>
                    
                    <!-- URL二维码 -->
                    <div class="tab-content" id="url-content">
                        <div class="input-group">
                            <label for="url-input" data-i18n="urlLabel">网址链接</label>
                            <input type="text" id="url-input" placeholder="请输入需要转换成二维码的网址..." data-i18n-placeholder="urlPlaceholder">
                            <p class="error" id="url-error" data-i18n="urlError">请输入有效的网址</p>
                        </div>
                        <div class="input-group">
                            <label>
                                <input type="checkbox" id="auto-prefix" checked>
                                <span data-i18n="autoPrefixLabel">自动添加 http:// 前缀（如果缺少）</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- 联系人二维码 -->
                    <div class="tab-content" id="vcard-content">
                        <div class="input-group">
                            <label for="name-input" data-i18n="vcardNameLabel">姓名</label>
                            <input type="text" id="name-input" placeholder="请输入姓名..." data-i18n-placeholder="vcardNamePlaceholder">
                            <p class="error" id="name-error" data-i18n="vcardNameError">请输入姓名</p>
                        </div>
                        <div class="input-group">
                            <label for="phone-input" data-i18n="vcardPhoneLabel">电话</label>
                            <input type="tel" id="phone-input" placeholder="请输入电话号码..." data-i18n-placeholder="vcardPhonePlaceholder">
                            <p class="error" id="phone-error" data-i18n="vcardPhoneError">请输入有效的电话号码</p>
                        </div>
                        <div class="input-group">
                            <label for="email-input" data-i18n="vcardEmailLabel">邮箱</label>
                            <input type="email" id="email-input" placeholder="请输入邮箱地址..." data-i18n-placeholder="vcardEmailPlaceholder">
                            <p class="error" id="email-error" data-i18n="vcardEmailError">请输入有效的邮箱地址</p>
                        </div>
                        <div class="input-group">
                            <label for="company-input" data-i18n="vcardCompanyLabel">公司</label>
                            <input type="text" id="company-input" placeholder="请输入公司名称..." data-i18n-placeholder="vcardCompanyPlaceholder">
                        </div>
                        <div class="input-group">
                            <label for="title-input" data-i18n="vcardTitleLabel">职位</label>
                            <input type="text" id="title-input" placeholder="请输入职位..." data-i18n-placeholder="vcardTitlePlaceholder">
                        </div>
                    </div>
                    
                </div>
                
                <div class="preview-section">
                    <h3 data-i18n="previewHeader">二维码预览</h3>
                    <div class="qrcode-container">
                        <div id="qrcode"></div>
                        <p class="qrcode-message" id="qrcode-message" data-i18n="previewMessageDefault">在左侧输入内容后点击生成按钮</p>
                    </div>
                    <div class="button-group">
                        <button class="generate-btn" id="generate-btn" data-i18n="generateBtn">生成二维码</button>
                        <button class="download-btn" id="download-btn" disabled data-i18n="downloadBtn">下载</button>
                        <button class="clear-btn" id="clear-btn" data-i18n="clearBtn">清空</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="faq-section">
            <h2 data-i18n="faqTitle">常见问题</h2>
            <div class="faq-item">
                <h3 data-i18n="faqQ1">什么是二维码？</h3>
                <p data-i18n="faqA1">二维码（QR Code）是一种二维条码，意为"快速响应码"，由日本Denso Wave公司于1994年发明。它可以存储各种类型的数据，并通过摄像头快速读取。想要了解更多，可以访问 <a href="https://en.wikipedia.org/wiki/QR_code" target="_blank">维基百科</a>。</p>
            </div>
            <div class="faq-item">
                <h3 data-i18n="faqQ2">生成的二维码会过期吗？扫描次数有限制吗？</h3>
                <p data-i18n="faqA2">不会。本工具生成的是静态二维码，它们永久有效，不会过期，扫描次数也没有限制。一旦创建，内容便无法修改。</p>
            </div>
            <div class="faq-item">
                <h3 data-i18n="faqQ3">生成的二维码可以商用吗？</h3>
                <p data-i18n="faqA3">完全可以。所有通过本工具创建的二维码都是免费的，您可以将它们用于任何商业或非商业场景。</p>
            </div>
            <div class="faq-item">
                <h3 data-i18n="faqQ4">我的二维码为什么无法扫描？</h3>
                <p data-i18n="faqA4">如果遇到扫描问题，请尝试以下步骤：1. 仔细检查输入的数据是否有误（如网址拼写错误）。2. 尝试减少数据量，特别是vCard等包含大量信息的内容，数据越少，二维码越容易识别。3. 确保二维码前景（黑色部分）与背景（白色部分）有足够的颜色对比度。</p>
            </div>
            <div class="faq-item">
                <h3 data-i18n="faqQ5">为什么我的vCard联系人信息显示不正确？</h3>
                <p data-i18n="faqA5">部分二维码扫描应用可能未完全遵循官方vCard标准，导致字段错乱。如果遇到此问题，建议更换另一款扫描应用尝试，通常可以解决。</p>
            </div>
            <div class="faq-item">
                <h3 data-i18n="faqQ6">你们会保存我的数据吗？</h3>
                <p data-i18n="faqA6">我们尊重您的隐私。我们不会以任何形式保存或重复使用您的个人数据。所有二维码生成都在您的浏览器中完成，您的数据不会发送到我们的服务器。</p>
            </div>
        </div>

        <footer>
            <p data-i18n="footerText">© 2025 QR Factory - 便捷的在线二维码生成工具</p>
        </footer>
    </div>
    
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            const translations = {
                'zh-CN': {
                    pageTitle: '免费二维码生成器 - 在线文字转二维码、网址二维码 | QR Factory',
                    metaDescription: 'QR Factory 提供简单快速的二维码生成工具，支持文字二维码、网址二维码、联系人二维码，在线生成，免费使用，支持PNG下载。',
                    subtitle: '简单、快速的二维码生成工具',
                    tabText: '文本二维码',
                    tabUrl: '网址二维码',
                    tabVcard: '联系人二维码',
                    textHeader: '输入文字',
                    textLabel: '文本内容',
                    textPlaceholder: '请输入需要转换成二维码的文本内容...',
                    textError: '请输入有效的文本内容',
                    textCounterUnit: '字符',
                    urlLabel: '网址链接',
                    urlPlaceholder: '请输入需要转换成二维码的网址...',
                    foregroundColorLabel: '前景色',
                    backgroundColorLabel: '背景色',
                    urlError: '请输入有效的网址',
                    autoPrefixLabel: '自动添加 http:// 前缀（如果缺少）',
                    vcardNameLabel: '姓名',
                    vcardNamePlaceholder: '请输入姓名...',
                    vcardNameError: '请输入姓名',
                    vcardPhoneLabel: '电话',
                    vcardPhonePlaceholder: '请输入电话号码...',
                    vcardPhoneError: '请输入有效的电话号码',
                    vcardEmailLabel: '邮箱',
                    vcardEmailPlaceholder: '请输入邮箱地址...',
                    vcardEmailError: '请输入有效的邮箱地址',
                    vcardCompanyLabel: '公司',
                    vcardCompanyPlaceholder: '请输入公司名称...',
                    vcardTitleLabel: '职位',
                    vcardTitlePlaceholder: '请输入职位...',
                    generateBtn: '生成二维码',
                    downloadBtn: '下载',
                    clearBtn: '清空',
                    previewHeader: '二维码预览',
                    previewMessageDefault: '在左侧输入内容后点击生成按钮',
                    footerText: '© 2025 QR Factory - 便捷的在线二维码生成工具',
                    langToggle: 'English',
                    qrCodeLibError: 'QRCode库加载失败，请检查网络连接或刷新页面重试',
                    qrGenerateError: '生成二维码时出错，请检查输入内容',
                    qrInvalidContent: '请输入有效内容生成二维码',
                    qrDownloadError: '下载二维码时出错，请稍后再试',
                    faqTitle: '常见问题',
                    faqQ1: '什么是二维码？',
                    faqA1: '二维码（QR Code）是一种二维条码，意为"快速响应码"，由日本Denso Wave公司于1994年发明。它可以存储各种类型的数据，并通过摄像头快速读取。想要了解更多，可以访问 <a href="https://en.wikipedia.org/wiki/QR_code" target="_blank">维基百科</a>。',
                    faqQ2: '生成的二维码会过期吗？扫描次数有限制吗？',
                    faqA2: '不会。本工具生成的是静态二维码，它们永久有效，不会过期，扫描次数也没有限制。一旦创建，内容便无法修改。',
                    faqQ3: '生成的二维码可以商用吗？',
                    faqA3: '完全可以。所有通过本工具创建的二维码都是免费的，您可以将它们用于任何商业或非商业场景。',
                    faqQ4: '我的二维码为什么无法扫描？',
                    faqA4: '如果遇到扫描问题，请尝试以下步骤：1. 仔细检查输入的数据是否有误（如网址拼写错误）。2. 尝试减少数据量，特别是vCard等包含大量信息的内容，数据越少，二维码越容易识别。3. 确保二维码前景（黑色部分）与背景（白色部分）有足够的颜色对比度。',
                    faqQ5: '为什么我的vCard联系人信息显示不正确？',
                    faqA5: '部分二维码扫描应用可能未完全遵循官方vCard标准，导致字段错乱。如果遇到此问题，建议更换另一款扫描应用尝试，通常可以解决。',
                    faqQ6: '你们会保存我的数据吗？',
                    faqA6: '我们尊重您的隐私。我们不会以任何形式保存或重复使用您的个人数据。所有二维码生成都在您的浏览器中完成，您的数据不会发送到我们的服务器。'
                },
                'en-US': {
                    pageTitle: 'Free QR Code Generator - Online Text to QR Code, URL QR Code | QR Factory',
                    metaDescription: 'QR Factory provides a simple and fast QR code generation tool, supporting text QR codes, URL QR codes, and contact QR codes. Generate online, free to use, and supports PNG download.',
                    subtitle: 'Simple and Fast QR Code Generator',
                    tabText: 'Text',
                    tabUrl: 'URL',
                    tabVcard: 'vCard',
                    textHeader: 'Text Content',
                    textLabel: 'Text Content',
                    textPlaceholder: 'Enter text to convert to QR code...',
                    textError: 'Please enter valid text content',
                    textCounterUnit: 'characters',
                    urlLabel: 'Website URL',
                    urlPlaceholder: 'Enter URL to convert to QR code...',
                    foregroundColorLabel: 'Foreground Color',
                    backgroundColorLabel: 'Background Color',
                    urlError: 'Please enter a valid URL',
                    autoPrefixLabel: 'Auto-add http:// prefix (if missing)',
                    vcardNameLabel: 'Name',
                    vcardNamePlaceholder: 'Enter name...',
                    vcardNameError: 'Please enter a name',
                    vcardPhoneLabel: 'Phone',
                    vcardPhonePlaceholder: 'Enter phone number...',
                    vcardPhoneError: 'Please enter a valid phone number',
                    vcardEmailLabel: 'Email',
                    vcardEmailPlaceholder: 'Enter email address...',
                    vcardEmailError: 'Please enter a valid email address',
                    vcardCompanyLabel: 'Company',
                    vcardCompanyPlaceholder: 'Enter company name...',
                    vcardTitleLabel: 'Title',
                    vcardTitlePlaceholder: 'Enter job title...',
                    generateBtn: 'Generate QR Code',
                    downloadBtn: 'Download',
                    clearBtn: 'Clear',
                    previewHeader: 'QR Code Preview',
                    previewMessageDefault: 'Enter content on the left and click generate',
                    footerText: '© 2025 QR Factory - A handy online QR code generator',
                    langToggle: '中文',
                    qrCodeLibError: 'Failed to load QRCode library, please check your network connection or refresh the page.',
                    qrGenerateError: 'Error generating QR code, please check your input.',
                    qrInvalidContent: 'Please enter valid content to generate a QR code.',
                    qrDownloadError: 'Error downloading QR code, please try again later.',
                    faqTitle: 'Frequently Asked Questions',
                    faqQ1: 'What is a QR Code?',
                    faqA1: 'A QR (Quick Response) code is a type of two-dimensional barcode invented in 1994 by Denso Wave. It can store various types of data and be read quickly by a camera. For more information, visit <a href="https://en.wikipedia.org/wiki/QR_code" target="_blank">Wikipedia</a>.',
                    faqQ2: 'Do the generated QR codes expire? Is there a scan limit?',
                    faqA2: 'No. The QR codes generated by this tool are static, meaning they are permanent, will not expire, and have no scan limits. Once created, their content cannot be edited.',
                    faqQ3: 'Can I use the generated QR codes for commercial purposes?',
                    faqA3: 'Absolutely. All QR codes created with this tool are free and can be used for any commercial or non-commercial purpose you wish.',
                    faqQ4: 'Why is my QR code not scannable?',
                    faqA4: 'If you encounter scanning issues, try these steps: 1. Double-check your input data for any errors (e.g., typos in a URL). 2. Try to reduce the amount of data, especially for content-heavy types like vCards; less data makes the QR code easier to read. 3. Ensure there is sufficient color contrast between the foreground (dark part) and background (light part).',
                    faqQ5: 'Why isn\'t my vCard showing the correct fields?',
                    faqA5: 'Some QR code scanning apps may not fully adhere to the official vCard standard, causing mixed-up fields. If you experience this, trying a different scanner app usually resolves the issue.',
                    faqQ6: 'Do you save my data?',
                    faqA6: 'We respect your privacy. We do not save or reuse your personal data in any form. All QR code generation happens directly in your browser, and your data is not sent to our servers.'
                }
            };

            let currentLang = localStorage.getItem('language') || 'zh-CN';

            // 检查QRCode库是否正确加载
            if (typeof QRCode === 'undefined') {
                console.error('QRCode库加载失败，请检查网络连接');
                alert(translations[currentLang].qrCodeLibError);
                return;
            }
            
            // 获取元素
            const langToggleBtn = document.getElementById('lang-toggle');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // 移除所有活动状态
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // 设置当前选项卡为活动状态
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-content`).classList.add('active');
                    
                    // 重置二维码区域
                    resetQRCode();
                });
            });
            
            // 获取元素
            const textInput = document.getElementById('text-input');
            const urlInput = document.getElementById('url-input');
            const nameInput = document.getElementById('name-input');
            const phoneInput = document.getElementById('phone-input');
            const emailInput = document.getElementById('email-input');
            const companyInput = document.getElementById('company-input');
            const titleInput = document.getElementById('title-input');
            const autoPrefix = document.getElementById('auto-prefix');
            
            const generateBtn = document.getElementById('generate-btn');
            const downloadBtn = document.getElementById('download-btn');
            const clearBtn = document.getElementById('clear-btn');
            
            const qrcodeContainer = document.getElementById('qrcode');
            const qrcodeMessage = document.getElementById('qrcode-message');
            const textCounter = document.getElementById('text-counter');
            
            // 获取颜色输入框
            const foregroundColorInput = document.getElementById('foreground-color');
            const backgroundColorInput = document.getElementById('background-color');

            // 获取可折叠元素
            const collapsibleHeader = document.querySelector('#text-content .collapsible-header');
            const collapsibleContent = document.querySelector('#text-content .collapsible-content');

            // 可折叠标题点击事件
            collapsibleHeader.addEventListener('click', function() {
                this.classList.toggle('active');
                collapsibleContent.classList.toggle('active');
            });
            
            // 语言切换功能
            function setLanguage(lang) {
                if (!translations[lang]) return;
                
                currentLang = lang;
                localStorage.setItem('language', lang);
                document.documentElement.lang = lang;
                
                document.title = translations[lang].pageTitle;
                langToggleBtn.textContent = translations[lang].langToggle;

                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                });
                
                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    if (translations[lang][key]) {
                        el.placeholder = translations[lang][key];
                    }
                });
                
                resetQRCode();
            }

            langToggleBtn.addEventListener('click', () => {
                const newLang = currentLang === 'zh-CN' ? 'en-US' : 'zh-CN';
                setLanguage(newLang);
            });
            
            // 文本计数器
            textInput.addEventListener('input', function() {
                textCounter.textContent = this.value.length;
            });
            
            // 自动生成二维码
            const inputElements = [textInput, urlInput, nameInput, phoneInput, emailInput, companyInput, titleInput];
            inputElements.forEach(element => {
                element.addEventListener('input', debounce(generateQRCode, 500));
            });
            autoPrefix.addEventListener('change', debounce(generateQRCode, 500));
            
            // 颜色输入框事件监听
            foregroundColorInput.addEventListener('input', debounce(generateQRCode, 500));
            backgroundColorInput.addEventListener('input', debounce(generateQRCode, 500));
            
            // 生成按钮点击事件
            generateBtn.addEventListener('click', generateQRCode);
            
            // 下载按钮点击事件
            downloadBtn.addEventListener('click', downloadQRCode);
            
            // 清空按钮点击事件
            clearBtn.addEventListener('click', clearInputs);
            
            // 防抖函数
            function debounce(func, delay) {
                let timeout;
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            }
            
            // 生成二维码
            function generateQRCode() {
                // 清空之前的二维码
                qrcodeContainer.innerHTML = '';
                qrcodeMessage.style.display = 'none';
                downloadBtn.disabled = true;
                
                // 获取当前激活的选项卡
                const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
                let content = '';
                let isValid = false;
                
                // 根据选项卡类型获取内容
                switch (activeTab) {
                    case 'text':
                        content = textInput.value.trim();
                        isValid = content.length > 0;
                        document.getElementById('text-error').style.display = isValid ? 'none' : 'block';
                        break;
                        
                    case 'url':
                        content = urlInput.value.trim();
                        // 自动添加http前缀
                        if (autoPrefix.checked && content && !content.match(/^https?:\/\//i)) {
                            content = 'http://' + content;
                            urlInput.value = content;
                        }
                        
                        // URL验证 - 修改正则表达式使其更宽松
                        isValid = content.length > 0 && /^(https?:\/\/)?([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,}([\/\w\.-]*)*\/?$/.test(content);
                        document.getElementById('url-error').style.display = isValid ? 'none' : 'block';
                        break;
                        
                    case 'vcard':
                        const name = nameInput.value.trim();
                        const phone = phoneInput.value.trim();
                        const email = emailInput.value.trim();
                        const company = companyInput.value.trim();
                        const title = titleInput.value.trim();
                        
                        // 验证必填字段
                        const nameValid = name.length > 0;
                        const phoneValid = phone.length === 0 || /^[\d\s\(\)\-\+]+$/.test(phone);
                        const emailValid = email.length === 0 || /^[\w.-]+@[\w.-]+\.\w+$/.test(email);
                        
                        document.getElementById('name-error').style.display = nameValid ? 'none' : 'block';
                        document.getElementById('phone-error').style.display = phoneValid ? 'none' : 'block';
                        document.getElementById('email-error').style.display = emailValid ? 'none' : 'block';
                        
                        isValid = nameValid && phoneValid && emailValid;
                        
                        if (isValid) {
                            // 生成vCard格式内容
                            content = [
                                'BEGIN:VCARD',
                                'VERSION:3.0',
                                `N:${name}`,
                                `FN:${name}`,
                                phone ? `TEL:${phone}` : '',
                                email ? `EMAIL:${email}` : '',
                                company ? `ORG:${company}` : '',
                                title ? `TITLE:${title}` : '',
                                'END:VCARD'
                            ].filter(Boolean).join('\n');
                        }
                        break;
                }
                
                if (isValid && content) {
                    try {
                        console.log('正在生成二维码，内容长度:', content.length);
                        
                        // 创建一个canvas元素
                        const canvas = document.createElement('canvas');
                        qrcodeContainer.appendChild(canvas);
                        
                        // 使用qrcode.js的toCanvas方法
                        QRCode.toCanvas(canvas, content, {
                            width: 400,
                            margin: 1,
                            errorCorrectionLevel: 'M',
                            color: {
                                dark: foregroundColorInput.value,  // 前景色
                                light: backgroundColorInput.value // 背景色
                            }
                        }, function(error) {
                            if (error) {
                                console.error('二维码生成错误:', error);
                                qrcodeContainer.removeChild(canvas);
                                qrcodeMessage.textContent = translations[currentLang].qrGenerateError;
                                qrcodeMessage.style.display = 'block';
                            } else {
                                console.log('二维码生成成功');
                                // 启用下载按钮
                                downloadBtn.disabled = false;
                            }
                        });
                    } catch (error) {
                        console.error('二维码生成异常:', error);
                        qrcodeMessage.textContent = translations[currentLang].qrGenerateError;
                        qrcodeMessage.style.display = 'block';
                    }
                } else {
                    const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
                    let hasAnyInput = false;
                    if (activeTab === 'text') {
                        hasAnyInput = textInput.value.trim() !== '';
                    } else if (activeTab === 'url') {
                        hasAnyInput = urlInput.value.trim() !== '';
                    } else if (activeTab === 'vcard') {
                        hasAnyInput = nameInput.value.trim() !== '' || phoneInput.value.trim() !== '' || emailInput.value.trim() !== '';
                    }

                    if (hasAnyInput) {
                        qrcodeMessage.textContent = translations[currentLang].qrInvalidContent;
                    } else {
                        qrcodeMessage.textContent = translations[currentLang].previewMessageDefault;
                    }
                    qrcodeMessage.style.display = 'block';
                }
            }
            
            // 下载二维码
            function downloadQRCode() {
                const canvas = qrcodeContainer.querySelector('canvas');
                if (!canvas) return;
                
                try {
                    // 创建临时链接
                    const link = document.createElement('a');
                    link.download = 'qrcode.png';
                    link.href = canvas.toDataURL('image/png');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (error) {
                    console.error('下载失败:', error);
                    alert(translations[currentLang].qrDownloadError);
                }
            }
            
            // 清空输入
            function clearInputs() {
                const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
                
                switch (activeTab) {
                    case 'text':
                        textInput.value = '';
                        textCounter.textContent = '0';
                        break;
                        
                    case 'url':
                        urlInput.value = '';
                        break;
                        
                    case 'vcard':
                        nameInput.value = '';
                        phoneInput.value = '';
                        emailInput.value = '';
                        companyInput.value = '';
                        titleInput.value = '';
                        break;
                }
                
                // 重置二维码区域
                resetQRCode();
                
                // 隐藏错误信息
                document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
            }
            
            // 重置二维码区域
            function resetQRCode() {
                qrcodeContainer.innerHTML = '';
                qrcodeMessage.textContent = translations[currentLang].previewMessageDefault;
                qrcodeMessage.style.display = 'block';
                downloadBtn.disabled = true;
            }

            // 初始化页面语言
            setLanguage(currentLang);
        });
    </script>
</body>
</html> 